"use strict";(self.webpackChunkmattermost_webapp=self.webpackChunkmattermost_webapp||[]).push([[11],{92600:(e,t,i)=>{i.d(t,{A:()=>u});var l=i(23453),n=i(26614),a=i(68124),s=i(62688),o=i.n(s),r=i(97023),c=i.n(r),d=i(14778),m=i(85873);const h=e=>{let{fileInfo:t,fileUrl:i,canDownloadFiles:l}=e;const n=(0,d.useIntl)(),a=[];""!==t.extension&&a.push(n.formatMessage({id:"file_info_preview.type",defaultMessage:"File type "})+t.extension.toUpperCase()),t.size&&a.push(n.formatMessage({id:"file_info_preview.size",defaultMessage:"Size "})+m.O1(t.size));const s=a.join(", ");let o=null;return o=l?c().createElement("a",{className:"file-details__preview",href:i},c().createElement("span",{className:"file-details__preview-helper"}),c().createElement("img",{alt:"file preview",src:m.Xm(t)})):c().createElement("span",{className:"file-details__preview"},c().createElement("span",{className:"file-details__preview-helper"}),c().createElement("img",{alt:"file preview",src:m.Xm(t)})),c().createElement("div",{className:"file-details__container"},o,c().createElement("div",{className:"file-details"},c().createElement("div",{className:"file-details__name"},t.name),c().createElement("div",{className:"file-details__info"},s)))};h.propTypes={fileUrl:o().string.isRequired,canDownloadFiles:o().bool.isRequired};const p=c().memo(h),u=(0,l.connect)((function(e){const t=(0,n.zj)(e);return{canDownloadFiles:(0,a.En)(t)}}))(p)},90011:(e,t,i)=>{i.r(t),i.d(t,{default:()=>de});var l=i(62688),n=i.n(l),a=(i(43813),i(17046),i(4290),i(71633)),s=i.n(a),o=i(97023),r=i.n(o),c=i(34529),d=i(14778),m=i(31655),h=i(85406);function p(e){const t=(0,d.useIntl)().formatMessage({id:"workspace_limits.archived_file.archived",defaultMessage:"This file is archived"}),i=r().createElement("span",{className:"file-details__preview file-details__preview--archived"},r().createElement(h.ArchiveOutlineIcon,{size:80,color:"rgba(var(--center-channel-color-rgb), 0.48)","data-testid":"archived-file-icon"}));return r().createElement("div",{className:"file-details__container"},i,r().createElement("div",{className:"file-details"},r().createElement("div",{className:"file-details__name"},e.fileInfo.name),r().createElement("div",{className:"file-details__info"},t)))}var u=i(23453),f=i(7380),v=i(92600),g=i(78451);function E(e,t,i){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class w extends r().PureComponent{constructor(e){super(e),E(this,"sourceRef",r().createRef()),E(this,"videoRef",r().createRef()),E(this,"handleFileInfoChanged",(()=>{let e=this.videoRef.current;e||(e=document.createElement("video")),this.setState({canPlay:!0})})),E(this,"handleLoadError",(()=>{this.setState({canPlay:!1})})),E(this,"stop",(()=>{if(this.videoRef.current){const e=this.videoRef.current;e.pause(),e.currentTime=0}})),this.state={canPlay:!0}}componentDidMount(){this.handleFileInfoChanged(),this.sourceRef.current&&this.sourceRef.current.addEventListener("error",this.handleLoadError,{once:!0})}componentDidUpdate(e){this.props.fileUrl!==e.fileUrl&&this.handleFileInfoChanged(),this.sourceRef.current&&this.sourceRef.current.addEventListener("error",this.handleLoadError,{once:!0})}render(){if(!this.state.canPlay)return r().createElement(v.A,{fileInfo:this.props.fileInfo,fileUrl:this.props.fileUrl});let e=g.Ay.WEB_VIDEO_WIDTH,t=g.Ay.WEB_VIDEO_HEIGHT;return this.props.isMobileView&&(e=g.Ay.MOBILE_VIDEO_WIDTH,t=g.Ay.MOBILE_VIDEO_HEIGHT),r().createElement("video",{key:this.props.fileInfo.id,ref:this.videoRef,"data-setup":"{}",controls:!0,width:e,height:t},r().createElement("source",{ref:this.sourceRef,src:this.props.fileUrl}))}}E(w,"propTypes",{fileUrl:n().string.isRequired,isMobileView:n().bool.isRequired});const _=(0,u.connect)((function(e){return{isMobileView:(0,f.w3)(e)}}))(w);var b=i(53654),I=i(75842);function y(e,t,i){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class C extends r().PureComponent{constructor(e){super(e),y(this,"getCode",(async()=>{if(this.state.lang&&!(this.props.fileInfo.size>g.Ay.CODE_PREVIEW_MAX_FILE_SIZE))try{const e=await fetch(this.props.fileUrl),t=await e.text();this.handleReceivedCode(t)}catch(e){this.handleReceivedError()}})),y(this,"handleReceivedCode",(async e=>{var t,i;let l=e;const n=e;"#document"===n.nodeName&&(l=(new XMLSerializer).serializeToString(n)),null===(t=(i=this.props).getContent)||void 0===t||t.call(i,l),this.setState({code:l,highlighted:await I.Zt(this.state.lang,l),loading:!1,success:!0})})),y(this,"handleReceivedError",(()=>{this.setState({loading:!1,success:!1})})),this.state={code:"",lang:"",highlighted:"",loading:!0,success:!0}}componentDidMount(){this.getCode()}static getDerivedStateFromProps(e,t){if(e.fileUrl!==t.prevFileUrl){const t=I.od(e.fileInfo.extension);return!t||e.fileInfo.size>g.Ay.CODE_PREVIEW_MAX_FILE_SIZE?{code:"",lang:"",loading:!1,success:!1,prevFileUrl:e.fileUrl}:{code:"",lang:t,loading:!0,prevFileUrl:e.fileUrl}}return null}componentDidUpdate(e){this.props.fileUrl!==e.fileUrl&&this.getCode()}static supports(e){return Boolean(I.od(e.extension))}render(){if(this.state.loading)return r().createElement("div",{className:"view-image__loading"},r().createElement(b.A,null));if(!this.state.success)return r().createElement(v.A,{fileInfo:this.props.fileInfo,fileUrl:this.props.fileUrl});const e=I.OT(this.state.lang);return r().createElement("div",{className:"post-code code-preview"},r().createElement("span",{className:"post-code__language"},"".concat(this.props.fileInfo.name," - ").concat(e)),r().createElement("div",{className:"hljs"},r().createElement("div",{className:"post-code__line-numbers"},I.bg(this.state.code)),r().createElement("code",{dangerouslySetInnerHTML:{__html:this.state.highlighted}})))}}y(C,"propTypes",{fileUrl:n().string.isRequired,className:n().string.isRequired,getContent:n().func});var R=i(7596),M=i(19513),N=i(85873),P=(i(29206),i(57406),i(55448),i(65952)),F=i(7430),L=i(18309);const x=(0,F.ml)(),k=e=>{const t=(0,u.useSelector)((t=>{var i,l;return(0,F.wz)(t,null!==(i=null===(l=e.post)||void 0===l?void 0:l.user_id)&&void 0!==i?i:"")})),i=(0,u.useSelector)((t=>{var i,l;return(0,P.s9)()(t,null!==(i=null===(l=e.post)||void 0===l?void 0:l.channel_id)&&void 0!==i?i:"")})),l=(0,u.useSelector)((t=>{var i,l;return x(t,null!==(i=null===(l=e.post)||void 0===l?void 0:l.user_id)&&void 0!==i?i:"",!0)}));let n;const a=i?r().createElement(d.FormattedMessage,{id:"file_preview_modal_info.shared_in",defaultMessage:"Shared in ~{name}",values:{name:i.display_name||i.name}}):null;return n=e.showFileName?r().createElement(r().Fragment,null,r().createElement("h5",{className:"file-preview-modal__file-name"},e.filename),r().createElement("span",{className:"file-preview-modal__file-details"},r().createElement("span",{className:"file-preview-modal__file-details-user-name"},l),r().createElement("span",{className:"file-preview-modal__channel"},a))):r().createElement(r().Fragment,null,r().createElement("h5",{className:"file-preview-modal__user-name"},l),r().createElement("span",{className:"file-preview-modal__channel"},a)),r().createElement("div",{className:"file-preview-modal__info"},e.post&&Object.keys(e.post).length>0&&r().createElement(L.A,{size:"lg",username:null==t?void 0:t.username,url:(0,N.RG)(e.post.user_id,null==t?void 0:t.last_picture_update),className:"file-preview-modal__avatar",alt:""}),r().createElement("div",{className:"file-preview-modal__info-details"},n))};k.propTypes={showFileName:n().bool.isRequired,filename:n().string.isRequired};const O=(0,o.memo)(k);var S=i(42474),A=i(69813),D=i(35301),q=i(17518),T=i(87131);function U(e){return Boolean(e.id)}function j(e){return Boolean(e.link)&&!U(e)}const Z=e=>{const t=(0,d.useIntl)(),i=(0,u.useSelector)((e=>{var t;return null===(t=(0,A.EL)(e))||void 0===t?void 0:t.link})),l=(0,u.useDispatch)(),[n,a]=(0,o.useState)(!1);(0,o.useEffect)((()=>{U(e.fileInfo)&&e.enablePublicLink&&l((0,S.EL)(e.fileInfo.id))}),[e.fileInfo,e.enablePublicLink]),(0,o.useEffect)((()=>{n&&setTimeout((()=>{a(!1)}),2e3)}),[n]);const s=t.formatMessage({id:"full_screen_modal.close",defaultMessage:"Close"}),c=r().createElement(T.A,{title:s,key:"publicLink"},r().createElement("button",{className:"file-preview-modal-main-actions__action-item",onClick:e.handleModalClose,"aria-label":s},r().createElement("i",{className:"icon icon-close"})));let m;m=n?t.formatMessage({id:"file_preview_modal_main_actions.public_link-copied",defaultMessage:"Public link copied"}):t.formatMessage({id:"view_image_popover.publicLink",defaultMessage:"Get a public link"});const h=r().createElement(T.A,{key:"filePreviewPublicLink",title:m},r().createElement("a",{href:"#",className:"file-preview-modal-main-actions__action-item",onClick:()=>{(0,N.lW)(null!=i?i:""),a(!0)},"aria-label":m},r().createElement("i",{className:"icon icon-link-variant"}))),p=t.formatMessage({id:"view_image_popover.download",defaultMessage:"Download"}),f=r().createElement(T.A,{key:"download",title:p},r().createElement(q.A,{href:e.fileURL,className:"file-preview-modal-main-actions__action-item",location:"file_preview_modal_main_actions",download:e.filename,"aria-label":p},r().createElement("i",{className:"icon icon-download-outline"}))),v=r().createElement(D.A,{className:"file-preview-modal-main-actions__action-item",isForText:(0,N.ti)(e.fileInfo.extension)===g.a0.TEXT,content:e.content});return r().createElement("div",{className:"file-preview-modal-main-actions__actions"},!e.showOnlyClose&&e.canCopyContent&&v,!e.showOnlyClose&&e.enablePublicLink&&e.showPublicLink&&h,!e.showOnlyClose&&e.canDownloadFiles&&f,e.showClose&&c)};Z.propTypes={showOnlyClose:n().bool,showClose:n().bool,showPublicLink:n().bool,filename:n().string.isRequired,fileURL:n().string.isRequired,enablePublicLink:n().bool.isRequired,canDownloadFiles:n().bool.isRequired,canCopyContent:n().bool.isRequired,handleModalClose:n().func.isRequired,content:n().string.isRequired},Z.defaultProps={showOnlyClose:!1,showClose:!0,showPublicLink:!0};const z=(0,o.memo)(Z),V=["post"],B=e=>{let{post:t}=e,i=function(e,t){if(null==e)return{};var i,l,n=function(e,t){if(null==e)return{};var i={};for(var l in e)if({}.hasOwnProperty.call(e,l)){if(t.includes(l))continue;i[l]=e[l]}return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(l=0;l<a.length;l++)i=a[l],t.includes(i)||{}.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}(e,V);return r().createElement("div",{className:"file-preview-modal-footer"},r().createElement(O,{showFileName:!1,post:t,filename:i.filename}),r().createElement(z,Object.assign({},i,{showClose:!1,showOnlyClose:!1})))};B.propTypes={filename:n().string.isRequired,fileURL:n().string.isRequired,showPublicLink:n().bool,enablePublicLink:n().bool.isRequired,canDownloadFiles:n().bool.isRequired,isExternalFile:n().bool.isRequired,handleModalClose:n().func.isRequired,canCopyContent:n().bool.isRequired,content:n().string.isRequired};const H=(0,o.memo)(B),G=e=>{const{formatMessage:t}=(0,d.useIntl)(),i=r().createElement(T.A,{key:"previewArrowLeft",title:r().createElement(d.FormattedMessage,{id:"generic.close",defaultMessage:"Close"})},r().createElement("button",{id:"previewArrowLeft",className:"file_preview_modal_main_nav__prev",onClick:e.handlePrev,"aria-label":t({id:"file_preview_modal_main_nav.prevAriaLabel",defaultMessage:"Previous file"})},r().createElement("i",{className:"icon icon-chevron-left"}))),l=r().createElement(T.A,{key:"publicLink",title:r().createElement(d.FormattedMessage,{id:"generic.next",defaultMessage:"Next"})},r().createElement("button",{id:"previewArrowRight",className:"file_preview_modal_main_nav__next",onClick:e.handleNext,"aria-label":t({id:"file_preview_modal_main_nav.nextAriaLabel",defaultMessage:"Next file"})},r().createElement("i",{className:"icon icon-chevron-right"})));return r().createElement("div",{className:"file_preview_modal_main_nav"},i,r().createElement("span",{className:"modal-bar-file-count","aria-live":"polite","aria-atomic":"true"},r().createElement(d.FormattedMessage,{id:"file_preview_modal_main_nav.file",defaultMessage:"{count, number} of {total, number}",values:{count:e.fileIndex+1,total:e.totalFiles}})),l)};G.propTypes={fileIndex:n().number.isRequired,totalFiles:n().number.isRequired,handlePrev:n().func.isRequired,handleNext:n().func.isRequired};const W=(0,o.memo)(G),X=["post","totalFiles","fileIndex"],K=e=>{let{post:t,totalFiles:i,fileIndex:l}=e,n=function(e,t){if(null==e)return{};var i,l,n=function(e,t){if(null==e)return{};var i={};for(var l in e)if({}.hasOwnProperty.call(e,l)){if(t.includes(l))continue;i[l]=e[l]}return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(l=0;l<a.length;l++)i=a[l],t.includes(i)||{}.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}(e,X),a=r().createElement("div",null);i>1&&(a=r().createElement(W,{totalFiles:i,fileIndex:l,handlePrev:n.handlePrev,handleNext:n.handleNext}));const s=r().createElement(z,Object.assign({},n,{showOnlyClose:n.isMobileView}));return r().createElement("div",{className:"file-preview-modal-header"},n.isMobileView&&s,!n.isMobileView&&r().createElement(O,{showFileName:!0,post:t,filename:n.filename}),a,!n.isMobileView&&s)};K.propTypes={isMobileView:n().bool.isRequired,fileIndex:n().number.isRequired,totalFiles:n().number.isRequired,filename:n().string.isRequired,fileURL:n().string.isRequired,showPublicLink:n().bool,enablePublicLink:n().bool.isRequired,canDownloadFiles:n().bool.isRequired,canCopyContent:n().bool.isRequired,isExternalFile:n().bool.isRequired,handlePrev:n().func.isRequired,handleNext:n().func.isRequired,handleModalClose:n().func.isRequired,content:n().string.isRequired};const J=(0,o.memo)(K);function Q(e){let t,i,l,{fileInfo:n,canDownloadFiles:a}=e;return n.id?(t=(0,m.S1)(n.id),i=n.has_preview_image?(0,m.cV)(n.id):t):(t=n.link,i=n.link),a?((0,N.ti)(n.extension)===g.a0.SVG&&(l={width:n.width,height:"auto"}),r().createElement("a",{className:"image_preview",href:"#"},r().createElement("img",{className:"image_preview__image",loading:"lazy","data-testid":"imagePreview",alt:"preview url image",src:i,style:l}))):r().createElement("img",{src:i})}Q.propTypes={canDownloadFiles:n().bool.isRequired};var Y,$,ee,te=i(46177),ie=i.n(te);class le extends r().PureComponent{render(){const e=[];let t=null;if(this.props.showZoomControls){let i,l,n;l=this.props.scale&&this.props.scale>g.tR.MIN_SCALE?r().createElement("span",{className:"modal-zoom-btn"},r().createElement("a",{onClick:this.props.handleZoomOut&&ie()(this.props.handleZoomOut,300,{maxWait:300})},r().createElement("i",{className:"icon icon-minus"}))):r().createElement("span",{className:"btn-inactive"},r().createElement("i",{className:"icon icon-minus"})),e.push(r().createElement(T.A,{key:"zoomOut",title:r().createElement(d.FormattedMessage,{id:"view_image.zoom_out",defaultMessage:"Zoom Out"})},l)),i=this.props.scale&&this.props.scale>g.tR.DEFAULT_SCALE?r().createElement("span",{className:"modal-zoom-btn"},r().createElement("a",{onClick:this.props.handleZoomReset},r().createElement("i",{className:"icon icon-magnify-minus"}))):this.props.scale&&this.props.scale<g.tR.DEFAULT_SCALE?r().createElement("span",{className:"modal-zoom-btn"},r().createElement("a",{onClick:this.props.handleZoomReset},r().createElement("i",{className:"icon icon-magnify-plus"}))):r().createElement("span",{className:"btn-inactive"},r().createElement("i",{className:"icon icon-magnify-minus"})),e.push(r().createElement(T.A,{key:"zoomReset",title:r().createElement(d.FormattedMessage,{id:"view_image.zoom_reset",defaultMessage:"Reset Zoom"})},i)),n=this.props.scale&&this.props.scale<g.tR.MAX_SCALE?r().createElement("span",{className:"modal-zoom-btn"},r().createElement("a",{onClick:this.props.handleZoomIn&&ie()(this.props.handleZoomIn,300,{maxWait:300})},r().createElement("i",{className:"icon icon-plus"}))):r().createElement("span",{className:"btn-inactive"},r().createElement("i",{className:"icon icon-plus"})),e.push(r().createElement(T.A,{key:"zoomIn",title:r().createElement(d.FormattedMessage,{id:"view_image.zoom_in",defaultMessage:"Zoom In"})},n)),t=r().createElement("div",{className:"modal-column"},e)}return r().createElement("div",{"data-testid":"fileCountFooter",className:"modal-button-bar file-preview-modal__zoom-bar"},t)}}Y=le,$="propTypes",ee={scale:n().number,showZoomControls:n().bool,handleZoomIn:n().func,handleZoomOut:n().func,handleZoomReset:n().func},($=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}($))in Y?Object.defineProperty(Y,$,{value:ee,enumerable:!0,configurable:!0,writable:!0}):Y[$]=ee;const ne=le;function ae(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,l)}return i}function se(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(i),!0).forEach((function(t){oe(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ae(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function oe(e,t,i){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const re=r().lazy((()=>Promise.all([i.e(1959),i.e(5660)]).then(i.bind(i,25660)))),ce=g.Ay.KeyCodes;class de extends r().PureComponent{constructor(e){super(e),oe(this,"handleNext",(()=>{let e=this.state.imageIndex+1;e>this.props.fileInfos.length-1&&(e=0),this.showImage(e)})),oe(this,"handlePrev",(()=>{let e=this.state.imageIndex-1;e<0&&(e=this.props.fileInfos.length-1),this.showImage(e)})),oe(this,"handleKeyPress",(e=>{M.e(e,ce.RIGHT)?this.handleNext():M.e(e,ce.LEFT)&&this.handlePrev()})),oe(this,"showImage",(e=>{this.setState({imageIndex:e});const t=window.innerHeight-100;this.setState({imageHeight:t}),this.state.loaded[e]||this.loadImage(e)})),oe(this,"isImageUrl",(e=>{const t=N.ti(e);return t===g.a0.IMAGE||t===g.a0.SVG})),oe(this,"getFileTypeFromFileInfo",(e=>{if(U(e))return N.ti(e.extension);if(j(e)){const t=11,i=e.extension&&e.extension.length<=t?e.extension:e.link;return N.ti(i)}return g.a0.OTHER})),oe(this,"loadImage",(e=>{const t=this.props.fileInfos[e];if(U(t)&&t.archived)this.handleImageLoaded(e);else if(this.getFileTypeFromFileInfo(t)===g.a0.IMAGE){let i="";U(t)?i=t.has_preview_image?(0,m.cV)(t.id):(0,m.w8)(t.id):j(t)&&(i=t.link),N.yt(i,(()=>this.handleImageLoaded(e)),(t=>this.handleImageProgress(e,t)))}else this.handleImageLoaded(e)})),oe(this,"handleImageLoaded",(e=>{this.setState((t=>({loaded:se(se({},t.loaded),{},{[e]:!0})})))})),oe(this,"handleImageProgress",((e,t)=>{this.setState((i=>({progress:se(se({},i.progress),{},{[e]:t})})))})),oe(this,"onMouseEnterImage",(()=>{this.setState({showCloseBtn:!0})})),oe(this,"onMouseLeaveImage",(()=>{this.setState({showCloseBtn:!1})})),oe(this,"setScale",((e,t)=>{this.setState((i=>({scale:se(se({},i.scale),{},{[e]:t})})))})),oe(this,"handleZoomIn",(()=>{let e=this.state.scale[this.state.imageIndex];e=Math.min(e+g.tR.SCALE_DELTA,g.tR.MAX_SCALE),this.setScale(this.state.imageIndex,e)})),oe(this,"handleZoomOut",(()=>{let e=this.state.scale[this.state.imageIndex];e=Math.max(e-g.tR.SCALE_DELTA,g.tR.MIN_SCALE),this.setScale(this.state.imageIndex,e)})),oe(this,"handleZoomReset",(()=>{this.setScale(this.state.imageIndex,g.tR.DEFAULT_SCALE)})),oe(this,"handleModalClose",(()=>{this.setState({show:!1})})),oe(this,"getContent",(e=>{this.setState({content:e})})),oe(this,"handleBgClose",(e=>{e.currentTarget===e.target&&this.handleModalClose()})),this.state={show:!0,imageIndex:this.props.startIndex,imageHeight:"100%",loaded:N.lI(!1,this.props.fileInfos.length),prevFileInfosCount:0,progress:N.lI(0,this.props.fileInfos.length),showCloseBtn:!1,showZoomControls:!1,scale:N.lI(g.tR.DEFAULT_SCALE,this.props.fileInfos.length),content:""}}componentDidMount(){document.addEventListener("keyup",this.handleKeyPress),this.showImage(this.props.startIndex)}componentWillUnmount(){document.removeEventListener("keyup",this.handleKeyPress)}static getDerivedStateFromProps(e,t){const i={};return e.fileInfos[t.imageIndex]&&e.fileInfos[t.imageIndex].extension===g.a0.PDF?i.showZoomControls=!0:i.showZoomControls=!1,e.fileInfos.length!==t.prevFileInfosCount&&(i.loaded=N.lI(!1,e.fileInfos.length),i.progress=N.lI(0,e.fileInfos.length),i.prevFileInfosCount=e.fileInfos.length),Object.keys(i).length?i:null}render(){var e;if(this.props.fileInfos.length<1||this.props.fileInfos.length-1<this.state.imageIndex)return null;const t=this.props.fileInfos[this.state.imageIndex],i=this.getFileTypeFromFileInfo(t);let l,n,a,o,h,u=!1;U(t)?(l=!0,n=t.name,a=(0,m.w8)(t.id),o=(0,m.S1)(t.id),h=!1):(l=!1,n=t.name||t.link,a=t.link,o=t.link,h=!0);let f,E,w="a11y__modal modal-image file-preview-modal";if(U(t)&&t.archived&&(f=r().createElement(p,{fileInfo:t})),!U(t)||!t.archived)if(this.state.loaded[this.state.imageIndex])i===g.a0.IMAGE||i===g.a0.SVG?f=r().createElement(Q,{fileInfo:t,canDownloadFiles:this.props.canDownloadFiles}):i===g.a0.VIDEO||i===g.a0.AUDIO?f=r().createElement(_,{fileInfo:t,fileUrl:a}):i===g.a0.PDF?(f=r().createElement("div",{className:"file-preview-modal__scrollable",onClick:this.handleBgClose},r().createElement(r().Suspense,{fallback:null},r().createElement(re,{fileInfo:t,fileUrl:a,scale:this.state.scale[this.state.imageIndex],handleBgClose:this.handleBgClose}))),E=r().createElement(ne,{scale:this.state.scale[this.state.imageIndex],showZoomControls:this.state.showZoomControls,handleZoomIn:this.handleZoomIn,handleZoomOut:this.handleZoomOut,handleZoomReset:this.handleZoomReset})):C.supports(t)?(w+=" modal-code",u=!0,f=r().createElement(C,{fileInfo:t,fileUrl:a,getContent:this.getContent,className:"file-preview-modal__code-preview"})):f=r().createElement(v.A,{fileInfo:t,fileUrl:a});else{const e=Math.floor(this.state.progress[this.state.imageIndex]);f=r().createElement(R.A,{loading:r().createElement(d.FormattedMessage,{id:"view_image.loading",defaultMessage:"Loading"}),progress:e})}if(U(t)&&!t.archived)for(const e of this.props.pluginFilePreviewComponents)if(e.override(t,this.props.post)){f=r().createElement(e.component,{fileInfo:t,post:this.props.post,onModalDismissed:this.handleModalClose});break}return r().createElement(c.Modal,{show:this.state.show,onHide:this.handleModalClose,onExited:this.props.onExited,className:"modal-image file-preview-modal",dialogClassName:w,animation:!0,backdrop:!1,role:"none",style:{paddingLeft:0},"aria-labelledby":"viewImageModalLabel"},r().createElement(c.Modal.Body,{className:"file-preview-modal__body"},r().createElement("div",{className:"modal-image__wrapper",onClick:this.handleModalClose},r().createElement("div",{className:"file-preview-modal__main-ctr",onMouseEnter:this.onMouseEnterImage,onMouseLeave:this.onMouseLeaveImage,onClick:e=>e.stopPropagation()},r().createElement(c.Modal.Title,{componentClass:"div",id:"viewImageModalLabel",className:"file-preview-modal__title"},r().createElement(J,{isMobileView:this.props.isMobileView,post:this.props.post,showPublicLink:l,fileIndex:this.state.imageIndex,totalFiles:null===(e=this.props.fileInfos)||void 0===e?void 0:e.length,filename:n,fileURL:o,fileInfo:t,enablePublicLink:this.props.enablePublicLink,canDownloadFiles:this.props.canDownloadFiles,canCopyContent:u,isExternalFile:h,handlePrev:this.handlePrev,handleNext:this.handleNext,handleModalClose:this.handleModalClose,content:this.state.content}),E),r().createElement("div",{className:s()("file-preview-modal__content",{"file-preview-modal__content-scrollable":(!U(t)||!t.archived)&&this.state.loaded[this.state.imageIndex]&&i===g.a0.PDF}),onClick:this.handleBgClose},f),this.props.isMobileView&&r().createElement(H,{post:this.props.post,showPublicLink:l,filename:n,fileURL:o,fileInfo:t,enablePublicLink:this.props.enablePublicLink,canDownloadFiles:this.props.canDownloadFiles,canCopyContent:u,isExternalFile:h,handleModalClose:this.handleModalClose,content:this.state.content})))))}}oe(de,"propTypes",{canDownloadFiles:n().bool.isRequired,enablePublicLink:n().bool.isRequired,isMobileView:n().bool.isRequired,pluginFilePreviewComponents:n().array,onExited:n().func.isRequired,postId:n().string,startIndex:n().number}),oe(de,"defaultProps",{fileInfos:[],startIndex:0,pluginFilePreviewComponents:[]})}}]);
//# sourceMappingURL=11.2338ee4b13ff18827e0d.js.map